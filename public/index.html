<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | Stock Broker</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div class="glass-card">
        <h1 class="text-center">Welcome Back</h1>
        <p class="text-center" style="color: var(--text-secondary); margin-bottom: 2rem;">
            Sign in to access your dashboard
        </p>

        <form id="loginForm">
            <label for="email" style="display: block; font-size: 0.9rem; color: var(--text-secondary);">Email
                Address</label>
            <input type="email" id="email" placeholder="name@example.com" required>

            <label for="password"
                style="display: block; font-size: 0.9rem; color: var(--text-secondary);">Password</label>
            <input type="password" id="password" placeholder="••••••••" required>

            <button type="submit">Sign In</button>
        </form>

        <p id="error-message" class="text-center mt-4" style="color: var(--error-color); font-size: 0.9rem;"></p>


    </div>

    <!-- Logic -->
    <script type="module">
        import { auth } from './firebase-config.js';
        import { signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Auto-redirect if already logged in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.location.href = 'dashboard.html';
            }
        });

        const loginForm = document.getElementById('loginForm');
        const errorMsg = document.getElementById('error-message');

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            errorMsg.textContent = "Authenticating...";

            try {
                // Try logging in
                await signInWithEmailAndPassword(auth, email, password);
                window.location.href = 'dashboard.html';
            } catch (error) {
                // Check specific error codes
                if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential' || error.code === 'auth/invalid-email') {
                    // Since Firebase changed error messages to be generic "invalid-credential" for security, 
                    // we might not distinguish wrong password vs user not found easily without an enumeration attack protect.
                    // However, purely for this demo request:

                    errorMsg.textContent = "Checking details...";

                    // If we want to strictly follow "if account doesnt exist popup message", 
                    // we can just catch the error and show the modal.

                    // NOTE: 'auth/invalid-credential' is the standard now. 
                    // We will assume if login fails, we ask them to check or sign up.

                    showSignupPopup();
                    errorMsg.textContent = "";
                } else {
                    errorMsg.textContent = error.message;
                }
            }
        });

        function showSignupPopup() {
            // Simple approach: Use browser confirm or a custom modal. 
            // User request: "popup a message to create account"
            // Let's inject a modal into the DOM

            let modal = document.getElementById('signup-prompt-modal');
            if (!modal) {
                const modalHTML = `
                <div id="signup-prompt-modal" style="position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; z-index:1000;">
                    <div class="glass-card" style="max-width:300px; text-align:center;">
                        <h3 style="margin-bottom:1rem;">Account Not Found</h3>
                        <p style="color:var(--text-secondary); margin-bottom:1.5rem;">It looks like you don't have an account yet.</p>
                        <button onclick="window.location.href='signup.html'" style="margin-bottom:0.5rem;">Create Account</button>
                        <button class="secondary" onclick="document.getElementById('signup-prompt-modal').remove()">Try Again</button>
                    </div>
                </div>`;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
            } else {
                // redundant check if we remove it on simple close
            }
        }
    </script>
</body>

</html>